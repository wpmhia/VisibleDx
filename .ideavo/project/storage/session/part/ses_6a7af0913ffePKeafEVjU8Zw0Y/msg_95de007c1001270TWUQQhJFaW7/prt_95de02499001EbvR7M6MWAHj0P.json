{
  "id": "prt_95de02499001EbvR7M6MWAHj0P",
  "messageID": "msg_95de007c1001270TWUQQhJFaW7",
  "sessionID": "ses_6a7af0913ffePKeafEVjU8Zw0Y",
  "type": "tool",
  "tool": "read",
  "callID": "toolu_01GpLb2HMqd9R7bAS1nNAsMX",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/new-patient/page.tsx"
    },
    "output": "<file>\n00001| 'use client'\n00002| \n00003| import { useState, useEffect } from 'react'\n00004| import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\n00005| import { Button } from '@/components/ui/button'\n00006| import { Input } from '@/components/ui/input'\n00007| import { Label } from '@/components/ui/label'\n00008| import { Progress } from '@/components/ui/progress'\n00009| import { Badge } from '@/components/ui/badge'\n00010| import { Alert, AlertDescription } from '@/components/ui/alert'\n00011| import { Checkbox } from '@/components/ui/checkbox'\n00012| import { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group'\n00013| import { ArrowRight, User, ClipboardList, FileText, Download, CheckCircle, AlertTriangle, Activity, Heart, Clock, BarChart3 } from 'lucide-react'\n00014| import Link from 'next/link'\n00015| import { useTranslation } from '@/lib/language-context'\n00016| \n00017| interface PatientData {\n00018|   demographics: {\n00019|     age: number | null\n00020|     gender: string\n00021|     clinicianName: string\n00022|     patientId: string\n00023|   }\n00024|   quickScreen: {\n00025|     answers: Record<number, boolean>\n00026|     score: number\n00027|     riskLevel: string\n00028|   }\n00029|   redFlags: {\n00030|     symptoms: string[]\n00031|     labsRecommended: string[]\n00032|     priority: string\n00033|   }\n00034|   standTest: {\n00035|     performed: boolean\n00036|     baselineHR: number | null\n00037|     peakHR: number | null\n00038|     sustainedHR: number | null\n00039|     meetsPOTS: boolean\n00040|   }\n00041|   pemQuest: {\n00042|     answers: Record<string, string>\n00043|     score: number\n00044|     severity: string\n00045|     present: boolean\n00046|   }\n00047|   diagnoses: {\n00048|     mecfs: { met: boolean; confidence: string }\n00049|     longCovid: { met: boolean; confidence: string }\n00050|     pots: { met: boolean; confidence: string; subtype?: string }\n00051|   }\n00052| }\n00053| \n00054| const initialPatientData: PatientData = {\n00055|   demographics: {\n00056|     age: null,\n00057|     gender: '',\n00058|     clinicianName: '',\n00059|     patientId: ''\n00060|   },\n00061|   quickScreen: {\n00062|     answers: {},\n00063|     score: 0,\n00064|     riskLevel: 'low'\n00065|   },\n00066|   redFlags: {\n00067|     symptoms: [],\n00068|     labsRecommended: [],\n00069|     priority: 'routine'\n00070|   },\n00071|   standTest: {\n00072|     performed: false,\n00073|     baselineHR: null,\n00074|     peakHR: null,\n00075|     sustainedHR: null,\n00076|     meetsPOTS: false\n00077|   },\n00078|   pemQuest: {\n00079|     answers: {},\n00080|     score: 0,\n00081|     severity: 'none',\n00082|     present: false\n00083|   },\n00084|   diagnoses: {\n00085|     mecfs: { met: false, confidence: 'low' },\n00086|     longCovid: { met: false, confidence: 'low' },\n00087|     pots: { met: false, confidence: 'low' }\n00088|   }\n00089| }\n00090| \n00091| type WorkflowStep = 'demographics' | 'quickScreen' | 'redFlags' | 'standTest' | 'pemQuest' | 'criteria' | 'summary'\n00092| \n00093| const createScreeningQuestions = (t: any) => t.quickScreen.questions.map((question: string, index: number) => ({\n00094|   id: index + 1,\n00095|   question,\n00096|   category: ['core', 'pem', 'core', 'core', 'cardiovascular', 'orthostatic', 'history', 'duration', 'pain', 'neurological', 'autonomic', 'gi', 'respiratory', 'functional', 'sensory', 'functional'][index]\n00097| }))\n00098| \n00099| const createRedFlagSymptoms = (t: any) => t.redFlag.symptoms.list.map((symptom: string, index: number) => ({\n00100|   id: ['fever', 'weight_loss', 'chest_pain', 'dyspnea', 'neurological', 'bleeding', 'lymphadenopathy', 'jaundice'][index],\n00101|   symptom,\n00102|   priority: 'high'\n00103| }))\n00104| \n00105| const createPemQuestions = (t: any) => [\n00106|   {\n00107|     id: 'frequency',\n00108|     question: t.pem.questions.frequency.question,\n00109|     options: t.pem.questions.frequency.options.map((label: string, index: number) => ({\n00110|       value: ['never', 'rarely', 'sometimes', 'often', 'always'][index],\n00111|       label,\n00112|       score: index\n00113|     }))\n00114|   },\n00115|   {\n00116|     id: 'severity',\n00117|     question: t.pem.questions.severity.question,\n00118|     options: t.pem.questions.severity.options.map((label: string, index: number) => ({\n00119|       value: ['none', 'mild', 'moderate', 'severe', 'very_severe'][index],\n00120|       label,\n00121|       score: index\n00122|     }))\n00123|   },\n00124|   {\n00125|     id: 'recovery_time',\n00126|     question: t.pem.questions.recoveryTime.question,\n00127|     options: t.pem.questions.recoveryTime.options.map((label: string, index: number) => ({\n00128|       value: ['no_recovery_needed', 'hours', 'one_day', 'several_days', 'week_or_more'][index],\n00129|       label,\n00130|       score: index\n00131|     }))\n00132|   }\n00133| ]\n00134| \n00135| export default function NewPatientWorkflow() {\n00136|   const { t } = useTranslation()\n00137|   const [currentStep, setCurrentStep] = useState<WorkflowStep>('demographics')\n00138|   const [patientData, setPatientData] = useState<PatientData>(initialPatientData)\n00139|   const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0)\n00140|   const [isComplete, setIsComplete] = useState(false)\n00141|   \n00142|   const screeningQuestions = createScreeningQuestions(t)\n00143|   const redFlagSymptoms = createRedFlagSymptoms(t)\n00144|   const pemQuestions = createPemQuestions(t)\n00145| \n00146|   // Auto-process criteria when in criteria step\n00147|   useEffect(() => {\n00148|     if (currentStep === 'criteria') {\n00149|       finalizeDiagnoses()\n00150|     }\n00151|   }, [currentStep])\n00152| \n00153|   const getStepProgress = () => {\n00154|     const steps: WorkflowStep[] = ['demographics', 'quickScreen', 'redFlags', 'standTest', 'pemQuest', 'criteria', 'summary']\n00155|     const currentIndex = steps.indexOf(currentStep)\n00156|     return ((currentIndex + 1) / steps.length) * 100\n00157|   }\n00158| \n00159|   const calculateQuickScreenRisk = (answers: Record<number, boolean>) => {\n00160|     const totalYes = Object.values(answers).filter(Boolean).length\n00161|     const coreSymptoms = [1, 3, 4].filter(id => answers[id]).length\n00162|     const pemPresent = answers[2]\n00163|     const chronicity = answers[8]\n00164|     \n00165|     let riskLevel = 'low'\n00166|     if (totalYes >= 8 && coreSymptoms >= 2 && pemPresent && chronicity) {\n00167|       riskLevel = 'high'\n00168|     } else if (totalYes >= 5 && (coreSymptoms >= 2 || pemPresent)) {\n00169|       riskLevel = 'medium'\n00170|     }\n00171|     \n00172|     return { score: totalYes, riskLevel }\n00173|   }\n00174| \n00175|   const calculatePEMScore = (answers: Record<string, string>) => {\n00176|     const totalScore = pemQuestions.reduce((sum, question) => {\n00177|       const answer = answers[question.id]\n00178|       const option = question.options.find(opt => opt.value === answer)\n00179|       return sum + (option?.score || 0)\n00180|     }, 0)\n00181| \n00182|     const maxScore = pemQuestions.reduce((sum, question) => {\n00183|       return sum + Math.max(...question.options.map(opt => opt.score))\n00184|     }, 0)\n00185| \n00186|     const percentage = (totalScore / maxScore) * 100\n00187|     \n00188|     let severity = 'none'\n00189|     if (percentage >= 75) severity = 'severe'\n00190|     else if (percentage >= 50) severity = 'moderate'\n00191|     else if (percentage >= 25) severity = 'mild'\n00192| \n00193|     return { score: totalScore, severity, present: percentage >= 25 }\n00194|   }\n00195| \n00196|   const determineNextStep = () => {\n00197|     switch (currentStep) {\n00198|       case 'demographics':\n00199|         return 'quickScreen'\n00200|       case 'quickScreen':\n00201|         return patientData.quickScreen.riskLevel !== 'low' ? 'redFlags' : 'standTest'\n00202|       case 'redFlags':\n00203|         return patientData.redFlags.priority === 'urgent' ? 'summary' : 'standTest'\n00204|       case 'standTest':\n00205|         return 'pemQuest'\n00206|       case 'pemQuest':\n00207|         return 'criteria'\n00208|       case 'criteria':\n00209|         return 'summary'\n00210|       default:\n00211|         return 'summary'\n00212|     }\n00213|   }\n00214| \n00215|   const generateSOAPNote = () => {\n00216|     const { demographics, quickScreen, redFlags, standTest, pemQuest, diagnoses } = patientData\n00217|     const currentDate = new Date().toLocaleDateString()\n00218|     \n00219|     let soap = `CLINICAL ASSESSMENT - VisibleDx Report\\n`\n00220|     soap += `=========================================\\n\\n`\n00221|     soap += `Date: ${currentDate}\\n`\n00222|     soap += `${t.soapNotes.clinician}: ${demographics.clinicianName || t.soapNotes.notSpecified}\\n`\n00223|     soap += `${t.soapNotes.patientId}: ${demographics.patientId || t.soapNotes.notSpecified}\\n`\n00224|     soap += `${t.soapNotes.age}: ${demographics.age || t.soapNotes.notSpecified} | ${t.soapNotes.gender}: ${demographics.gender || t.soapNotes.notSpecified}\\n\\n`\n00225| \n00226|     soap += `SUBJECTIVE:\\n`\n00227|     soap += `Chief Complaint: Chronic fatigue, post-exertional symptoms, and orthostatic intolerance\\n`\n00228|     soap += `Quick-Screen Risk Assessment: ${quickScreen.riskLevel.toUpperCase()} (${quickScreen.score}/16 positive responses)\\n`\n00229|     \n00230|     if (redFlags.symptoms.length > 0) {\n00231|       soap += `Red Flag Symptoms: ${redFlags.symptoms.join(', ')}\\n`\n00232|     } else {\n00233|       soap += `Red Flag Symptoms: None identified\\n`\n00234|     }\n00235|     \n00236|     soap += `Post-Exertional Malaise: ${pemQuest.present ? `${t.soapNotes.pemPresent} (${pemQuest.severity} ${t.soapNotes.severity})` : t.soapNotes.notPresent}\\n`\n00237|     soap += `Symptom Duration: ${patientData.quickScreen.answers[8] ? '≥3 months' : '<3 months or unclear'}\\n\\n`\n00238| \n00239|     soap += `OBJECTIVE:\\n`\n00240|     if (standTest.performed) {\n00241|       soap += `Orthostatic Vital Signs (10-min stand test):\\n`\n00242|       soap += `  - ${t.soapNotes.baselineHR}: ${standTest.baselineHR || t.soapNotes.notRecorded} bpm\\n`\n00243|       soap += `  - ${t.soapNotes.peakStandingHR}: ${standTest.peakHR || t.soapNotes.notRecorded} bpm\\n`\n00244|       soap += `  - ${t.soapNotes.hrIncrease}: ${standTest.peakHR && standTest.baselineHR ? standTest.peakHR - standTest.baselineHR : t.soapNotes.cannotCalculate} bpm\\n`\n00245|       soap += `  - POTS Criteria: ${standTest.meetsPOTS ? t.soapNotes.potsCriteriaMet : t.soapNotes.potsNotMet}\\n`\n00246|     } else {\n00247|       soap += `Orthostatic Testing: Not performed\\n`\n00248|     }\n00249|     \n00250|     if (redFlags.labsRecommended.length > 0) {\n00251|       soap += `Recommended Laboratory Studies: ${redFlags.labsRecommended.join(', ')}\\n`\n00252|     }\n00253|     soap += `\\n`\n00254| \n00255|     soap += `ASSESSMENT:\\n`\n00256|     const positiveDiagnoses: string[] = []\n00257|     if (diagnoses.mecfs.met) positiveDiagnoses.push(`ME/CFS (G93.32) - ${diagnoses.mecfs.confidence} confidence`)\n00258|     if (diagnoses.longCovid.met) positiveDiagnoses.push(`Long COVID (U09.9) - ${diagnoses.longCovid.confidence} confidence`)\n00259|     if (diagnoses.pots.met) positiveDiagnoses.push(`POTS (I47.1) - ${diagnoses.pots.confidence} confidence`)\n00260|     \n00261|     if (positiveDiagnoses.length > 0) {\n00262|       soap += `Diagnoses meeting criteria:\\n`\n00263|       positiveDiagnoses.forEach(dx => soap += `  • ${dx}\\n`)\n00264|     } else {\n00265|       soap += `No definitive diagnostic criteria met at this time\\n`\n00266|       soap += `Consider: Alternative diagnoses, subclinical presentations, symptom monitoring\\n`\n00267|     }\n00268|     soap += `\\n`\n00269| \n00270|     soap += `PLAN:\\n`\n00271|     \n00272|     if (redFlags.priority === 'urgent') {\n00273|       soap += `URGENT: Complete red flag workup before proceeding with chronic illness evaluation\\n`\n00274|       soap += `  - Expedite recommended laboratory studies\\n`\n00275|       soap += `  - Consider same-day or next-day specialist consultation\\n\\n`\n00276|     }\n00277|     \n00278|     if (diagnoses.mecfs.met) {\n00279|       soap += `ME/CFS Management:\\n`\n00280|       soap += `  • Activity pacing and energy management education\\n`\n00281|       soap += `  • Avoid graded exercise therapy (contraindicated)\\n`\n00282|       soap += `  • Symptom-directed treatments (sleep, pain, orthostatic symptoms)\\n`\n00283|       soap += `  • ME/CFS specialist referral if available\\n`\n00284|       soap += `  • Disability evaluation if functional capacity severely impaired\\n\\n`\n00285|     }\n00286|     \n00287|     if (diagnoses.longCovid.met) {\n00288|       soap += `Long COVID Management:\\n`\n00289|       soap += `  • Multidisciplinary symptom management approach\\n`\n00290|       soap += `  • Long COVID clinic referral if available\\n`\n00291|       soap += `  • Monitor for improvement over time\\n`\n00292|       soap += `  • Address individual symptoms (fatigue, cognitive, respiratory)\\n\\n`\n00293|     }\n00294|     \n00295|     if (diagnoses.pots.met) {\n00296|       soap += `POTS Management:\\n`\n00297|       soap += `  • Non-pharmacological: Increase salt (8-10g/day), fluids (2.5-3L/day)\\n`\n00298|       soap += `  • Compression garments (30-40 mmHg)\\n`\n00299|       soap += `  • Consider pharmacological therapy based on subtype\\n`\n00300|       soap += `  • Cardiology or autonomic specialist referral\\n`\n00301|       soap += `  • Gradual exercise reconditioning when appropriate\\n\\n`\n00302|     }\n00303|     \n00304|     soap += `Follow-up:\\n`\n00305|     soap += `  • Reassess in 4-6 weeks or sooner if symptoms worsen\\n`\n00306|     soap += `  • Repeat stand test if POTS suspected but initial test inconclusive\\n`\n00307|     soap += `  • Review laboratory results and adjust treatment accordingly\\n`\n00308|     soap += `  • Patient education materials provided\\n\\n`\n00309|     \n00310|     soap += `Clinical Decision Support provided by VisibleDx v1.0\\n`\n00311|     soap += `This assessment is for clinical decision support only and does not replace physician judgment.\\n`\n00312| \n00313|     return soap\n00314|   }\n00315| \n00316|   const handleDemographicsNext = () => {\n00317|     if (patientData.demographics.age && patientData.demographics.gender) {\n00318|       setCurrentStep('quickScreen')\n00319|     }\n00320|   }\n00321| \n00322|   const handleQuickScreenAnswer = (questionId: number, answer: boolean) => {\n00323|     const newAnswers = { ...patientData.quickScreen.answers, [questionId]: answer }\n00324|     const risk = calculateQuickScreenRisk(newAnswers)\n00325|     \n00326|     setPatientData(prev => ({\n00327|       ...prev,\n00328|       quickScreen: {\n00329|         answers: newAnswers,\n00330|         score: risk.score,\n00331|         riskLevel: risk.riskLevel\n00332|       }\n00333|     }))\n00334|   }\n00335| \n00336|   const handlePEMAnswer = (questionId: string, value: string) => {\n00337|     const newAnswers = { ...patientData.pemQuest.answers, [questionId]: value }\n00338|     const pemScore = calculatePEMScore(newAnswers)\n00339|     \n00340|     setPatientData(prev => ({\n00341|       ...prev,\n00342|       pemQuest: {\n00343|         answers: newAnswers,\n00344|         score: pemScore.score,\n00345|         severity: pemScore.severity,\n00346|         present: pemScore.present\n00347|       }\n00348|     }))\n00349|   }\n00350| \n00351|   const finalizeDiagnoses = () => {\n00352|     const { quickScreen, pemQuest, standTest } = patientData\n00353|     \n00354|     // ME/CFS criteria\n00355|     const coreSymptoms = [1, 3, 4].filter(id => quickScreen.answers[id]).length\n00356|     const hasPEM = pemQuest.present\n00357|     const hasOrthostatic = quickScreen.answers[6] || standTest.meetsPOTS\n00358|     const mecfsMet = coreSymptoms >= 3 && hasPEM && hasOrthostatic && quickScreen.answers[8]\n00359|     \n00360|     // Long COVID criteria\n00361|     const hasCovidHistory = quickScreen.answers[7]\n00362|     const hasDuration = quickScreen.answers[8]\n00363|     const hasMultiSystem = quickScreen.score >= 4\n00364|     const longCovidMet = hasCovidHistory && hasDuration && hasMultiSystem\n00365|     \n00366|     // POTS criteria\n00367|     const potsMet = standTest.meetsPOTS && quickScreen.answers[8] && (quickScreen.answers[5] || quickScreen.answers[6])\n00368|     \n00369|     setPatientData(prev => ({\n00370|       ...prev,\n00371|       diagnoses: {\n00372|         mecfs: { \n00373|           met: mecfsMet, \n00374|           confidence: mecfsMet ? (coreSymptoms === 3 && hasPEM ? 'high' : 'medium') : 'low' \n00375|         },\n00376|         longCovid: { \n00377|           met: longCovidMet, \n00378|           confidence: longCovidMet ? 'high' : 'low' \n00379|         },\n00380|         pots: { \n00381|           met: potsMet, \n00382|           confidence: potsMet ? 'high' : 'low' \n00383|         }\n00384|       }\n00385|     }))\n00386|     \n00387|     setCurrentStep('summary')\n00388|     setIsComplete(true)\n00389|   }\n00390| \n00391|   if (isComplete) {\n00392|     const soap = generateSOAPNote()\n00393|     const anyDiagnosis = Object.values(patientData.diagnoses).some(d => d.met)\n00394|     \n00395|     return (\n00396|       <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8\">\n00397|         <div className=\"container mx-auto px-4 max-w-4xl\">\n00398|           <Card>\n00399|             <CardHeader className=\"text-center\">\n00400|               <CardTitle className=\"flex items-center justify-center gap-2 text-2xl\">\n00401|                 <CheckCircle className=\"h-6 w-6 text-green-600\" />\n00402|                 {t.newPatient.results.title}\n00403|               </CardTitle>\n00404|               <CardDescription>\n00405|                 {t.newPatient.results.description}\n00406|               </CardDescription>\n00407|             </CardHeader>\n00408|             <CardContent className=\"space-y-6\">\n00409|               <div className=\"grid md:grid-cols-3 gap-4\">\n00410|                 <Card className={`border-2 ${patientData.diagnoses.mecfs.met ? 'border-green-500 bg-green-50' : 'border-gray-200'}`}>\n00411|                   <CardContent className=\"pt-4\">\n00412|                     <div className=\"text-center\">\n00413|                       <h3 className=\"font-semibold text-sm\">ME/CFS (G93.32)</h3>\n00414|                       <Badge variant={patientData.diagnoses.mecfs.met ? 'default' : 'secondary'} className=\"mt-2\">\n00415|                         {patientData.diagnoses.mecfs.met ? t.criteria.results.criteriaMet : t.common.notMet}\n00416|                       </Badge>\n00417|                       {patientData.diagnoses.mecfs.met && (\n00418|                         <p className=\"text-xs text-green-700 mt-1\">\n00419|                           {t.common.confidence}: {patientData.diagnoses.mecfs.confidence}\n00420|                         </p>\n00421|                       )}\n00422|                     </div>\n00423|                   </CardContent>\n00424|                 </Card>\n00425| \n00426|                 <Card className={`border-2 ${patientData.diagnoses.longCovid.met ? 'border-green-500 bg-green-50' : 'border-gray-200'}`}>\n00427|                   <CardContent className=\"pt-4\">\n00428|                     <div className=\"text-center\">\n00429|                       <h3 className=\"font-semibold text-sm\">Long COVID (U09.9)</h3>\n00430|                       <Badge variant={patientData.diagnoses.longCovid.met ? 'default' : 'secondary'} className=\"mt-2\">\n00431|                         {patientData.diagnoses.longCovid.met ? t.criteria.results.criteriaMet : t.common.notMet}\n00432|                       </Badge>\n00433|                       {patientData.diagnoses.longCovid.met && (\n00434|                         <p className=\"text-xs text-green-700 mt-1\">\n00435|                           {t.common.confidence}: {patientData.diagnoses.longCovid.confidence}\n00436|                         </p>\n00437|                       )}\n00438|                     </div>\n00439|                   </CardContent>\n00440|                 </Card>\n00441| \n00442|                 <Card className={`border-2 ${patientData.diagnoses.pots.met ? 'border-green-500 bg-green-50' : 'border-gray-200'}`}>\n00443|                   <CardContent className=\"pt-4\">\n00444|                     <div className=\"text-center\">\n00445|                       <h3 className=\"font-semibold text-sm\">POTS (I47.1)</h3>\n00446|                       <Badge variant={patientData.diagnoses.pots.met ? 'default' : 'secondary'} className=\"mt-2\">\n00447|                         {patientData.diagnoses.pots.met ? t.criteria.results.criteriaMet : t.common.notMet}\n00448|                       </Badge>\n00449|                       {patientData.diagnoses.pots.met && (\n00450|                         <p className=\"text-xs text-green-700 mt-1\">\n00451|                           {t.common.confidence}: {patientData.diagnoses.pots.confidence}\n00452|                         </p>\n00453|                       )}\n00454|                     </div>\n00455|                   </CardContent>\n00456|                 </Card>\n00457|               </div>\n00458| \n00459|               {!anyDiagnosis && (\n00460|                 <Alert>\n00461|                   <AlertTriangle className=\"h-4 w-4\" />\n00462|                   <AlertDescription>\n00463|                     <strong>{t.newPatient.results.noDefinitiveDiagnoses}:</strong> Consider alternative diagnoses, \n00464|                     subclinical presentations, or ongoing symptom monitoring. Some patients may \n00465|                     benefit from symptomatic treatment while monitoring for progression.\n00466|                   </AlertDescription>\n00467|                 </Alert>\n00468|               )}\n00469| \n00470|               <div className=\"bg-blue-50 p-4 rounded-lg\">\n00471|                 <h4 className=\"font-semibold mb-2 text-blue-900\">{t.newPatient.results.keyResults}</h4>\n00472|                 <div className=\"grid md:grid-cols-2 gap-4 text-sm\">\n00473|                   <div>\n00474|                     <p><strong>{t.newPatient.results.riskLevel}:</strong> {patientData.quickScreen.riskLevel.toUpperCase()}</p>\n00475|                     <p><strong>{t.newPatient.results.screeningScore}:</strong> {patientData.quickScreen.score}/16</p>\n00476|                     <p><strong>{t.newPatient.results.pemPresent}:</strong> {patientData.pemQuest.present ? t.common.yes : t.common.no}</p>\n00477|                   </div>\n00478|                   <div>\n00479|                     <p><strong>{t.newPatient.results.potsCriteria}:</strong> {patientData.standTest.meetsPOTS ? t.common.met : t.common.notMet}</p>\n00480|                     <p><strong>{t.newPatient.results.redFlags}:</strong> {patientData.redFlags.symptoms.length > 0 ? patientData.redFlags.symptoms.length + ' identified' : t.common.none}</p>\n00481|                     <p><strong>{t.newPatient.results.priority}:</strong> {patientData.redFlags.priority}</p>\n00482|                   </div>\n00483|                 </div>\n00484|               </div>\n00485| \n00486|               <div className=\"flex gap-4 justify-center\">\n00487|                 <Button onClick={() => {\n00488|                   setPatientData(initialPatientData)\n00489|                   setCurrentStep('demographics')\n00490|                   setCurrentQuestionIndex(0)\n00491|                   setIsComplete(false)\n00492|                 }} variant=\"outline\">\n00493|                   {t.newPatient.results.newAssessment}\n00494|                 </Button>\n00495|                 <Button onClick={() => {\n00496|                   const blob = new Blob([soap], { type: 'text/plain' })\n00497|                   const url = URL.createObjectURL(blob)\n00498|                   const a = document.createElement('a')\n00499|                   a.href = url\n00500|                   a.download = `autodx-soap-note-${new Date().toISOString().split('T')[0]}.txt`\n00501|                   a.click()\n00502|                   URL.revokeObjectURL(url)\n00503|                 }} className=\"flex items-center gap-2\">\n00504|                   <Download className=\"h-4 w-4\" />\n00505|                   {t.newPatient.results.downloadSOAP}\n00506|                 </Button>\n00507|               </div>\n00508|             </CardContent>\n00509|           </Card>\n00510|         </div>\n00511|       </div>\n00512|     )\n00513|   }\n00514| \n00515|   // Demographics Step\n00516|   if (currentStep === 'demographics') {\n00517|     return (\n00518|       <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8\">\n00519|         <div className=\"container mx-auto px-4 max-w-2xl\">\n00520|           <div className=\"mb-6\">\n00521|             <div className=\"flex items-center gap-4 mb-4\">\n00522|               <User className=\"h-5 w-5 text-blue-600\" />\n00523|               <div>\n00524|                 <h1 className=\"text-2xl font-bold text-gray-900\">{t.newPatient.title}</h1>\n00525|                 <p className=\"text-gray-600\">{t.newPatient.description}</p>\n00526|               </div>\n00527|             </div>\n00528|             \n00529|             <Progress value={getStepProgress()} className=\"h-2\" />\n00530|             <p className=\"text-sm text-gray-600 mt-2\">{t.newPatient.demographics.step}</p>\n00531|           </div>\n00532| \n00533|           <Card>\n00534|             <CardHeader>\n00535|               <CardTitle>{t.newPatient.demographics.title}</CardTitle>\n00536|               <CardDescription>{t.newPatient.demographics.description}</CardDescription>\n00537|             </CardHeader>\n00538|             <CardContent className=\"space-y-4\">\n00539|               <div className=\"grid md:grid-cols-2 gap-4\">\n00540|                 <div>\n00541|                   <Label htmlFor=\"age\">{t.newPatient.demographics.age} *</Label>\n00542|                   <Input\n00543|                     id=\"age\"\n00544|                     type=\"number\"\n00545|                     placeholder=\"25\"\n00546|                     value={patientData.demographics.age || ''}\n00547|                     onChange={(e) => setPatientData(prev => ({\n00548|                       ...prev,\n00549|                       demographics: { ...prev.demographics, age: parseInt(e.target.value) || null }\n00550|                     }))}\n00551|                   />\n00552|                 </div>\n00553|                 <div>\n00554|                   <Label>{t.newPatient.demographics.gender} *</Label>\n00555|                   <RadioGroup \n00556|                     value={patientData.demographics.gender} \n00557|                     onValueChange={(value) => setPatientData(prev => ({\n00558|                       ...prev,\n00559|                       demographics: { ...prev.demographics, gender: value }\n00560|                     }))}\n00561|                     className=\"flex gap-4 mt-2\"\n00562|                   >\n00563|                     <div className=\"flex items-center space-x-2\">\n00564|                       <RadioGroupItem value=\"female\" id=\"female\" />\n00565|                       <Label htmlFor=\"female\">{t.common.female}</Label>\n00566|                     </div>\n00567|                     <div className=\"flex items-center space-x-2\">\n00568|                       <RadioGroupItem value=\"male\" id=\"male\" />\n00569|                       <Label htmlFor=\"male\">{t.common.male}</Label>\n00570|                     </div>\n00571|                     <div className=\"flex items-center space-x-2\">\n00572|                       <RadioGroupItem value=\"other\" id=\"other\" />\n00573|                       <Label htmlFor=\"other\">{t.common.other}</Label>\n00574|                     </div>\n00575|                   </RadioGroup>\n00576|                 </div>\n00577|               </div>\n00578|               \n00579|               <div className=\"grid md:grid-cols-2 gap-4\">\n00580|                 <div>\n00581|                   <Label htmlFor=\"clinician\">{t.newPatient.demographics.clinicianName}</Label>\n00582|                   <Input\n00583|                     id=\"clinician\"\n00584|                     placeholder=\"Dr. Smith\"\n00585|                     value={patientData.demographics.clinicianName}\n00586|                     onChange={(e) => setPatientData(prev => ({\n00587|                       ...prev,\n00588|                       demographics: { ...prev.demographics, clinicianName: e.target.value }\n00589|                     }))}\n00590|                   />\n00591|                 </div>\n00592|                 <div>\n00593|                   <Label htmlFor=\"patientId\">{t.newPatient.demographics.patientId}</Label>\n00594|                   <Input\n00595|                     id=\"patientId\"\n00596|                     placeholder=\"12345\"\n00597|                     value={patientData.demographics.patientId}\n00598|                     onChange={(e) => setPatientData(prev => ({\n00599|                       ...prev,\n00600|                       demographics: { ...prev.demographics, patientId: e.target.value }\n00601|                     }))}\n00602|                   />\n00603|                 </div>\n00604|               </div>\n00605| \n00606|               <div className=\"flex justify-end pt-4\">\n00607|                 <Button \n00608|                   onClick={handleDemographicsNext}\n00609|                   disabled={!patientData.demographics.age || !patientData.demographics.gender}\n00610|                   className=\"flex items-center gap-2\"\n00611|                 >\n00612|                   {t.newPatient.demographics.startAssessment}\n00613|                   <ArrowRight className=\"h-4 w-4\" />\n00614|                 </Button>\n00615|               </div>\n00616|             </CardContent>\n00617|           </Card>\n00618|         </div>\n00619|       </div>\n00620|     )\n00621|   }\n00622| \n00623|   // Quick Screen Step\n00624|   if (currentStep === 'quickScreen') {\n00625|     const currentQuestion = screeningQuestions[currentQuestionIndex]\n00626|     const currentAnswer = patientData.quickScreen.answers[currentQuestion.id]\n00627|     const progress = ((currentQuestionIndex + 1) / screeningQuestions.length) * 100\n00628| \n00629|     return (\n00630|       <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8\">\n00631|         <div className=\"container mx-auto px-4 max-w-2xl\">\n00632|           <div className=\"mb-6\">\n00633|             <div className=\"flex items-center gap-4 mb-4\">\n00634|               <Clock className=\"h-5 w-5 text-orange-600\" />\n00635|               <div>\n00636|                 <h1 className=\"text-2xl font-bold text-gray-900\">{t.quickScreen.title}</h1>\n00637|                 <p className=\"text-gray-600\">{t.quickScreen.description}</p>\n00638|               </div>\n00639|             </div>\n00640|             \n00641|             <Progress value={getStepProgress()} className=\"h-2 mb-2\" />\n00642|             <Progress value={progress} className=\"h-1\" />\n00643|             <p className=\"text-sm text-gray-600 mt-2\">\n00644|               {t.common.question} {currentQuestionIndex + 1} {t.common.of} {screeningQuestions.length}\n00645|             </p>\n00646|           </div>\n00647| \n00648|           <Card>\n00649|             <CardHeader>\n00650|               <CardTitle className=\"text-lg\">{currentQuestion.question}</CardTitle>\n00651|               <CardDescription>{t.common.category}: {currentQuestion.category}</CardDescription>\n00652|             </CardHeader>\n00653|             <CardContent>\n00654|               <div className=\"space-y-4\">\n00655|                 <div className=\"flex gap-4 justify-center\">\n00656|                   <Button\n00657|                     onClick={() => handleQuickScreenAnswer(currentQuestion.id, true)}\n00658|                     variant={currentAnswer === true ? \"default\" : \"outline\"}\n00659|                     className=\"flex items-center gap-2 px-8\"\n00660|                   >\n00661|                     {t.common.yes}\n00662|                   </Button>\n00663|                   <Button\n00664|                     onClick={() => handleQuickScreenAnswer(currentQuestion.id, false)}\n00665|                     variant={currentAnswer === false ? \"default\" : \"outline\"}\n00666|                     className=\"flex items-center gap-2 px-8\"\n00667|                   >\n00668|                     {t.common.no}\n00669|                   </Button>\n00670|                 </div>\n00671| \n00672|                 <div className=\"flex justify-between pt-6\">\n00673|                   <Button \n00674|                     onClick={() => setCurrentQuestionIndex(prev => prev - 1)} \n00675|                     disabled={currentQuestionIndex === 0}\n00676|                     variant=\"outline\"\n00677|                   >\n00678|                     {t.common.previous}\n00679|                   </Button>\n00680|                   \n00681|                   <Button \n00682|                     onClick={() => {\n00683|                       if (currentQuestionIndex < screeningQuestions.length - 1) {\n00684|                         setCurrentQuestionIndex(prev => prev + 1)\n00685|                       } else {\n00686|                         setCurrentStep(determineNextStep())\n00687|                       }\n00688|                     }}\n00689|                     disabled={currentAnswer === undefined}\n00690|                   >\n00691|                     {currentQuestionIndex === screeningQuestions.length - 1 ? t.common.continue : t.common.next}\n00692|                   </Button>\n00693|                 </div>\n00694|               </div>\n00695|             </CardContent>\n00696|           </Card>\n00697|         </div>\n00698|       </div>\n00699|     )\n00700|   }\n00701| \n00702|   // Red Flags Step\n00703|   if (currentStep === 'redFlags') {\n00704|     return (\n00705|       <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8\">\n00706|         <div className=\"container mx-auto px-4 max-w-3xl\">\n00707|           <div className=\"mb-6\">\n00708|             <div className=\"flex items-center gap-4 mb-4\">\n00709|               <AlertTriangle className=\"h-5 w-5 text-red-600\" />\n00710|               <div>\n00711|                 <h1 className=\"text-2xl font-bold text-gray-900\">{t.newPatient.redFlags.title}</h1>\n00712|                 <p className=\"text-gray-600\">{t.newPatient.redFlags.description}</p>\n00713|               </div>\n00714|             </div>\n00715|             <Progress value={getStepProgress()} className=\"h-2\" />\n00716|           </div>\n00717| \n00718|           <Card>\n00719|             <CardHeader>\n00720|               <CardTitle>{t.redFlag.symptoms.title}</CardTitle>\n00721|               <CardDescription>{t.newPatient.redFlags.selectSymptoms}</CardDescription>\n00722|             </CardHeader>\n00723|             <CardContent>\n00724|               <div className=\"space-y-3\">\n00725|                 {redFlagSymptoms.map((flag) => (\n00726|                   <div key={flag.id} className=\"flex items-start space-x-3 p-3 rounded-lg border hover:bg-gray-50\">\n00727|                     <Checkbox\n00728|                       id={flag.id}\n00729|                       checked={patientData.redFlags.symptoms.includes(flag.id)}\n00730|                       onCheckedChange={(checked) => {\n00731|                         if (checked) {\n00732|                           setPatientData(prev => ({\n00733|                             ...prev,\n00734|                             redFlags: {\n00735|                               ...prev.redFlags,\n00736|                               symptoms: [...prev.redFlags.symptoms, flag.id],\n00737|                               priority: flag.priority === 'high' ? 'urgent' : prev.redFlags.priority\n00738|                             }\n00739|                           }))\n00740|                         } else {\n00741|                           const newSymptoms = patientData.redFlags.symptoms.filter(s => s !== flag.id)\n00742|                           setPatientData(prev => ({\n00743|                             ...prev,\n00744|                             redFlags: {\n00745|                               ...prev.redFlags,\n00746|                               symptoms: newSymptoms,\n00747|                               priority: newSymptoms.some(s => redFlagSymptoms.find(rf => rf.id === s)?.priority === 'high') ? 'urgent' : 'routine'\n00748|                             }\n00749|                           }))\n00750|                         }\n00751|                       }}\n00752|                     />\n00753|                     <Label htmlFor={flag.id} className=\"cursor-pointer text-sm flex-1\">\n00754|                       {flag.symptom}\n00755|                     </Label>\n00756|                   </div>\n00757|                 ))}\n00758|               </div>\n00759|               \n00760|               <div className=\"flex justify-center pt-6\">\n00761|                 <Button onClick={() => setCurrentStep(determineNextStep())}>\n00762|                   {t.newPatient.redFlags.continueAssessment}\n00763|                 </Button>\n00764|               </div>\n00765|             </CardContent>\n00766|           </Card>\n00767|         </div>\n00768|       </div>\n00769|     )\n00770|   }\n00771| \n00772|   // Stand Test Step\n00773|   if (currentStep === 'standTest') {\n00774|     return (\n00775|       <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8\">\n00776|         <div className=\"container mx-auto px-4 max-w-3xl\">\n00777|           <div className=\"mb-6\">\n00778|             <div className=\"flex items-center gap-4 mb-4\">\n00779|               <Heart className=\"h-5 w-5 text-red-600\" />\n00780|               <div>\n00781|                 <h1 className=\"text-2xl font-bold text-gray-900\">{t.newPatient.standTest.title}</h1>\n00782|                 <p className=\"text-gray-600\">{t.newPatient.standTest.description}</p>\n00783|               </div>\n00784|             </div>\n00785|             <Progress value={getStepProgress()} className=\"h-2\" />\n00786|           </div>\n00787| \n00788|           <Card>\n00789|             <CardHeader>\n00790|               <CardTitle>{t.newPatient.standTest.measurements}</CardTitle>\n00791|               <CardDescription>{t.newPatient.standTest.measurementDescription}</CardDescription>\n00792|             </CardHeader>\n00793|             <CardContent className=\"space-y-4\">\n00794|               <div className=\"grid md:grid-cols-2 gap-4\">\n00795|                 <div>\n00796|                   <Label htmlFor=\"baselineHR\">{t.newPatient.standTest.baselineHR}</Label>\n00797|                   <Input\n00798|                     id=\"baselineHR\"\n00799|                     type=\"number\"\n00800|                     placeholder=\"70\"\n00801|                     value={patientData.standTest.baselineHR || ''}\n00802|                     onChange={(e) => setPatientData(prev => ({\n00803|                       ...prev,\n00804|                       standTest: {\n00805|                         ...prev.standTest,\n00806|                         baselineHR: parseInt(e.target.value) || null\n00807|                       }\n00808|                     }))}\n00809|                   />\n00810|                 </div>\n00811|                 <div>\n00812|                   <Label htmlFor=\"peakHR\">{t.newPatient.standTest.peakHR}</Label>\n00813|                   <Input\n00814|                     id=\"peakHR\"\n00815|                     type=\"number\"\n00816|                     placeholder=\"110\"\n00817|                     value={patientData.standTest.peakHR || ''}\n00818|                     onChange={(e) => {\n00819|                       const peakHR = parseInt(e.target.value) || null\n00820|                       const baselineHR = patientData.standTest.baselineHR\n00821|                       const meetsPOTS = peakHR && baselineHR ? (peakHR - baselineHR >= 30) : false\n00822|                       \n00823|                       setPatientData(prev => ({\n00824|                         ...prev,\n00825|                         standTest: {\n00826|                           ...prev.standTest,\n00827|                           peakHR,\n00828|                           sustainedHR: peakHR,\n00829|                           meetsPOTS,\n00830|                           performed: true\n00831|                         }\n00832|                       }))\n00833|                     }}\n00834|                   />\n00835|                 </div>\n00836|               </div>\n00837|               \n00838|               {patientData.standTest.baselineHR && patientData.standTest.peakHR && (\n00839|                 <Alert className={patientData.standTest.meetsPOTS ? 'border-red-200 bg-red-50' : 'border-green-200 bg-green-50'}>\n00840|                   <Heart className=\"h-4 w-4\" />\n00841|                   <AlertDescription>\n00842|                     <strong>{t.newPatient.standTest.hrIncrease}: {patientData.standTest.peakHR - patientData.standTest.baselineHR} {t.common.bpm}</strong><br />\n00843|                     {t.newPatient.standTest.potsCriteria} (≥30 {t.common.bpm}): {patientData.standTest.meetsPOTS ? t.common.met.toUpperCase() : t.common.notMet}\n00844|                   </AlertDescription>\n00845|                 </Alert>\n00846|               )}\n00847|               \n00848|               <div className=\"flex justify-center pt-4\">\n00849|                 <Button \n00850|                   onClick={() => setCurrentStep(determineNextStep())}\n00851|                   disabled={!patientData.standTest.baselineHR || !patientData.standTest.peakHR}\n00852|                 >\n00853|                   {t.newPatient.standTest.continueToPEM}\n00854|                 </Button>\n00855|               </div>\n00856|             </CardContent>\n00857|           </Card>\n00858|         </div>\n00859|       </div>\n00860|     )\n00861|   }\n00862| \n00863|   // PEM Quest Step\n00864|   if (currentStep === 'pemQuest') {\n00865|     const currentPEMQuestion = pemQuestions[currentQuestionIndex % pemQuestions.length]\n00866|     const currentAnswer = patientData.pemQuest.answers[currentPEMQuestion.id]\n00867|     const progress = ((currentQuestionIndex + 1) / pemQuestions.length) * 100\n00868| \n00869|     return (\n00870|       <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8\">\n00871|         <div className=\"container mx-auto px-4 max-w-3xl\">\n00872|           <div className=\"mb-6\">\n00873|             <div className=\"flex items-center gap-4 mb-4\">\n00874|               <Activity className=\"h-5 w-5 text-orange-600\" />\n00875|               <div>\n00876|                 <h1 className=\"text-2xl font-bold text-gray-900\">{t.newPatient.pemAssessment.title}</h1>\n00877|                 <p className=\"text-gray-600\">{t.newPatient.pemAssessment.description}</p>\n00878|               </div>\n00879|             </div>\n00880|             <Progress value={getStepProgress()} className=\"h-2 mb-2\" />\n00881|             <Progress value={progress} className=\"h-1\" />\n00882|             <p className=\"text-sm text-gray-600 mt-2\">\n00883|               {t.common.question} {(currentQuestionIndex % pemQuestions.length) + 1} {t.common.of} {pemQuestions.length}\n00884|             </p>\n00885|           </div>\n00886| \n00887|           <Card>\n00888|             <CardHeader>\n00889|               <CardTitle className=\"text-lg\">{currentPEMQuestion.question}</CardTitle>\n00890|             </CardHeader>\n00891|             <CardContent>\n00892|               <RadioGroup \n00893|                 value={currentAnswer || ''} \n00894|                 onValueChange={(value) => handlePEMAnswer(currentPEMQuestion.id, value)}\n00895|                 className=\"space-y-3\"\n00896|               >\n00897|                 {currentPEMQuestion.options.map((option) => (\n00898|                   <div key={option.value} className=\"flex items-start space-x-3 p-3 rounded-lg border hover:bg-gray-50\">\n00899|                     <RadioGroupItem value={option.value} id={option.value} className=\"mt-1\" />\n00900|                     <Label htmlFor={option.value} className=\"cursor-pointer flex-1\">\n00901|                       {option.label}\n00902|                     </Label>\n00903|                   </div>\n00904|                 ))}\n00905|               </RadioGroup>\n00906| \n00907|               <div className=\"flex justify-between pt-6\">\n00908|                 <Button \n00909|                   onClick={() => setCurrentQuestionIndex(prev => prev - 1)} \n00910|                   disabled={currentQuestionIndex === 0}\n00911|                   variant=\"outline\"\n00912|                 >\n00913|                   Previous\n00914|                 </Button>\n00915|                 \n00916|                 <Button \n00917|                   onClick={() => {\n00918|                     if (currentQuestionIndex < pemQuestions.length - 1) {\n00919|                       setCurrentQuestionIndex(prev => prev + 1)\n00920|                     } else {\n00921|                       setCurrentStep('criteria')\n00922|                     }\n00923|                   }}\n00924|                   disabled={!currentAnswer}\n00925|                 >\n00926|                   {currentQuestionIndex === pemQuestions.length - 1 ? t.newPatient.pemAssessment.finalizeAssessment : t.common.next}\n00927|                 </Button>\n00928|               </div>\n00929|             </CardContent>\n00930|           </Card>\n00931|         </div>\n00932|       </div>\n00933|     )\n00934|   }\n00935| \n00936|   // Criteria Step (auto-process)\n00937|   if (currentStep === 'criteria') {\n00938|     return (\n00939|       <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8\">\n00940|         <div className=\"container mx-auto px-4 max-w-2xl\">\n00941|           <Card>\n00942|             <CardContent className=\"pt-6 text-center\">\n00943|               <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4\"></div>\n00944|               <h3 className=\"text-lg font-semibold mb-2\">{t.newPatient.processing.title}</h3>\n00945|               <p className=\"text-gray-600\">{t.newPatient.processing.description}</p>\n00946|             </CardContent>\n00947|           </Card>\n00948|         </div>\n00949|       </div>\n00950|     )\n00951|   }\n00952| \n00953|   return <div>Loading...</div>\n00954| }\n</file>",
    "metadata": {
      "preview": "'use client'\n\nimport { useState, useEffect } from 'react'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { Progress } from '@/components/ui/progress'\nimport { Badge } from '@/components/ui/badge'\nimport { Alert, AlertDescription } from '@/components/ui/alert'\nimport { Checkbox } from '@/components/ui/checkbox'\nimport { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group'\nimport { ArrowRight, User, ClipboardList, FileText, Download, CheckCircle, AlertTriangle, Activity, Heart, Clock, BarChart3 } from 'lucide-react'\nimport Link from 'next/link'\nimport { useTranslation } from '@/lib/language-context'\n\ninterface PatientData {\n  demographics: {\n    age: number | null\n    gender: string"
    },
    "title": "app/new-patient/page.tsx",
    "time": {
      "start": 1758216595036,
      "end": 1758216595041
    }
  }
}