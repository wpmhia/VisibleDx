{
  "id": "prt_958df1150001uN6l2aW4CMosmv",
  "messageID": "msg_958dedd94001tVh1fU45OvbbIM",
  "sessionID": "ses_6a7af0913ffePKeafEVjU8Zw0Y",
  "type": "tool",
  "tool": "read",
  "callID": "toolu_01MK6F7bodM9XXknaLAGp4qB",
  "state": {
    "status": "completed",
    "input": {
      "filePath": "/home/user/project/app/criteria-engine/page.tsx"
    },
    "output": "<file>\n00001| 'use client'\n00002| \n00003| import { useState } from 'react'\n00004| import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\n00005| import { Button } from '@/components/ui/button'\n00006| import { Checkbox } from '@/components/ui/checkbox'\n00007| import { Badge } from '@/components/ui/badge'\n00008| import { Alert, AlertDescription } from '@/components/ui/alert'\n00009| import { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group'\n00010| import { Label } from '@/components/ui/label'\n00011| import { ArrowLeft, BarChart3, CheckCircle, AlertTriangle, FileText, Download } from 'lucide-react'\n00012| import Link from 'next/link'\n00013| import { useTranslation } from '@/lib/language-context'\n00014| \n00015| interface DiagnosticCriteria {\n00016|   id: string\n00017|   condition: string\n00018|   met: boolean\n00019|   criteria: { id: string; description: string; met: boolean }[]\n00020|   icdCode: string\n00021|   confidence: 'high' | 'medium' | 'low'\n00022| }\n00023| \n00024| // Criteria will be generated from translations\n00025| \n00026| export default function CriteriaEngine() {\n00027|   const { t } = useTranslation()\n00028|   \n00029|   const getMECFSCriteria = () => t.criteria.mecfs.criteria.map((desc, index) => ({\n00030|     id: ['fatigue', 'pem', 'sleep', 'cognitive', 'orthostatic'][index],\n00031|     description: desc,\n00032|     met: false\n00033|   }))\n00034|   \n00035|   const getLongCovidCriteria = () => t.criteria.longCovid.criteria.map((desc, index) => ({\n00036|     id: ['covid_history', 'duration', 'multisystem', 'unexplained'][index],\n00037|     description: desc,\n00038|     met: false\n00039|   }))\n00040|   \n00041|   const getPOTSCriteria = () => t.criteria.pots.criteria.map((desc, index) => ({\n00042|     id: ['hr_increase', 'sustained', 'symptoms', 'duration_pots', 'no_oh'][index],\n00043|     description: desc,\n00044|     met: false\n00045|   }))\n00046| \n00047|   const [mecfsChecked, setMecfsChecked] = useState(() => getMECFSCriteria())\n00048|   const [longCovidChecked, setLongCovidChecked] = useState(() => getLongCovidCriteria())\n00049|   const [potsChecked, setPotsChecked] = useState(() => getPOTSCriteria())\n00050|   const [covidTiming, setCovidTiming] = useState<string>('')\n00051|   const [isComplete, setIsComplete] = useState(false)\n00052| \n00053|   const handleMECFSChange = (id: string, checked: boolean) => {\n00054|     setMecfsChecked(prev => prev.map(item => \n00055|       item.id === id ? { ...item, met: checked } : item\n00056|     ))\n00057|   }\n00058| \n00059|   const handleLongCovidChange = (id: string, checked: boolean) => {\n00060|     setLongCovidChecked(prev => prev.map(item => \n00061|       item.id === id ? { ...item, met: checked } : item\n00062|     ))\n00063|   }\n00064| \n00065|   const handlePOTSChange = (id: string, checked: boolean) => {\n00066|     setPotsChecked(prev => prev.map(item => \n00067|       item.id === id ? { ...item, met: checked } : item\n00068|     ))\n00069|   }\n00070| \n00071|   const calculateDiagnoses = (): DiagnosticCriteria[] => {\n00072|     const diagnoses: DiagnosticCriteria[] = []\n00073| \n00074|     // ME/CFS Diagnosis (requires fatigue, PEM, sleep, and either cognitive OR orthostatic)\n00075|     const mecfsCore = mecfsChecked.filter(c => ['fatigue', 'pem', 'sleep'].includes(c.id) && c.met).length\n00076|     const mecfsAdditional = mecfsChecked.filter(c => ['cognitive', 'orthostatic'].includes(c.id) && c.met).length\n00077|     const mecfsMet = mecfsCore === 3 && mecfsAdditional >= 1\n00078|     \n00079|     diagnoses.push({\n00080|       id: 'mecfs',\n00081|       condition: 'Myalgic Encephalomyelitis/Chronic Fatigue Syndrome (ME/CFS)',\n00082|       met: mecfsMet,\n00083|       criteria: mecfsChecked,\n00084|       icdCode: 'G93.32',\n00085|       confidence: mecfsMet ? (mecfsCore === 3 && mecfsAdditional === 2 ? 'high' : 'medium') : 'low'\n00086|     })\n00087| \n00088|     // Long COVID Diagnosis\n00089|     const longCovidMet = longCovidChecked.filter(c => c.met).length >= 3\n00090|     diagnoses.push({\n00091|       id: 'longcovid',\n00092|       condition: 'Long COVID (Post-acute sequelae of SARS-CoV-2)',\n00093|       met: longCovidMet,\n00094|       criteria: longCovidChecked,\n00095|       icdCode: 'U09.9',\n00096|       confidence: longCovidMet ? 'high' : 'low'\n00097|     })\n00098| \n00099|     // POTS Diagnosis (requires HR increase + symptoms + duration + no OH)\n00100|     const potsEssential = potsChecked.filter(c => ['hr_increase', 'symptoms', 'duration_pots', 'no_oh'].includes(c.id) && c.met).length\n00101|     const potsMet = potsEssential >= 4\n00102|     \n00103|     diagnoses.push({\n00104|       id: 'pots',\n00105|       condition: 'Postural Orthostatic Tachycardia Syndrome (POTS)',\n00106|       met: potsMet,\n00107|       criteria: potsChecked,\n00108|       icdCode: 'I47.1',\n00109|       confidence: potsMet ? 'high' : 'low'\n00110|     })\n00111| \n00112|     return diagnoses\n00113|   }\n00114| \n00115|   const generateReport = () => {\n00116|     const diagnoses = calculateDiagnoses()\n00117|     const positives = diagnoses.filter(d => d.met)\n00118|     \n00119|     let report = \"AutoDx Clinical Decision Support Report\\n\"\n00120|     report += \"=====================================\\n\\n\"\n00121|     \n00122|     report += \"DIAGNOSTIC SUMMARY:\\n\"\n00123|     if (positives.length === 0) {\n00124|       report += \"• No criteria met for ME/CFS, Long COVID, or POTS\\n\"\n00125|       report += \"• Consider alternative diagnoses\\n\"\n00126|       report += \"• Reassess if symptoms progress\\n\\n\"\n00127|     } else {\n00128|       positives.forEach(dx => {\n00129|         report += `• ${dx.condition} - CRITERIA MET (${dx.icdCode})\\n`\n00130|         report += `  Confidence: ${dx.confidence.toUpperCase()}\\n`\n00131|       })\n00132|       report += \"\\n\"\n00133|     }\n00134| \n00135|     report += \"DETAILED CRITERIA ASSESSMENT:\\n\\n\"\n00136|     \n00137|     diagnoses.forEach(dx => {\n00138|       report += `${dx.condition} (${dx.icdCode}):\\n`\n00139|       dx.criteria.forEach(criterion => {\n00140|         report += `  ${criterion.met ? '✓' : '✗'} ${criterion.description}\\n`\n00141|       })\n00142|       report += `  Result: ${dx.met ? 'CRITERIA MET' : 'Criteria not met'}\\n\\n`\n00143|     })\n00144| \n00145|     return report\n00146|   }\n00147| \n00148|   if (isComplete) {\n00149|     const diagnoses = calculateDiagnoses()\n00150|     const positives = diagnoses.filter(d => d.met)\n00151|     \n00152|     return (\n00153|       <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8\">\n00154|         <div className=\"container mx-auto px-4 max-w-4xl\">\n00155|           <Card>\n00156|             <CardHeader className=\"text-center\">\n00157|               <CardTitle className=\"flex items-center justify-center gap-2 text-2xl\">\n00158|                 <CheckCircle className=\"h-6 w-6 text-green-600\" />\n00159|                 {t.criteria.results.complete}\n00160|               </CardTitle>\n00161|               <CardDescription>\n00162|                 {t.criteria.results.description}\n00163|               </CardDescription>\n00164|             </CardHeader>\n00165|             <CardContent className=\"space-y-6\">\n00166|               {positives.length > 0 ? (\n00167|                 <div className=\"space-y-4\">\n00168|                   <h3 className=\"text-lg font-semibold text-center mb-4\">{t.criteria.results.diagnosesMet}</h3>\n00169|                   {positives.map((diagnosis) => (\n00170|                     <Alert key={diagnosis.id} className=\"border-green-200 bg-green-50\">\n00171|                       <CheckCircle className=\"h-4 w-4 text-green-600\" />\n00172|                       <AlertDescription>\n00173|                         <div className=\"flex justify-between items-start\">\n00174|                           <div>\n00175|                             <strong className=\"text-green-800\">{diagnosis.condition}</strong>\n00176|                             <p className=\"text-green-700 text-sm mt-1\">\n00177|                               ICD-10 Code: {diagnosis.icdCode} | Confidence: {diagnosis.confidence}\n00178|                             </p>\n00179|                           </div>\n00180|                           <Badge className=\"bg-green-100 text-green-800\">\n00181|                             {t.criteria.results.criteriaMet}\n00182|                           </Badge>\n00183|                         </div>\n00184|                       </AlertDescription>\n00185|                     </Alert>\n00186|                   ))}\n00187|                 </div>\n00188|               ) : (\n00189|                 <Alert>\n00190|                   <AlertTriangle className=\"h-4 w-4\" />\n00191|                   <AlertDescription>\n00192|                     <strong>No Diagnostic Criteria Met</strong><br />\n00193|                     Consider alternative diagnoses or reassess if symptoms progress. \n00194|                     Some patients may have subclinical presentations requiring ongoing monitoring.\n00195|                   </AlertDescription>\n00196|                 </Alert>\n00197|               )}\n00198| \n00199|               <div className=\"grid md:grid-cols-3 gap-4\">\n00200|                 {diagnoses.map((diagnosis) => (\n00201|                   <Card key={diagnosis.id} className={`border-2 ${\n00202|                     diagnosis.met ? 'border-green-500 bg-green-50' : 'border-gray-200'\n00203|                   }`}>\n00204|                     <CardHeader className=\"pb-3\">\n00205|                       <CardTitle className=\"text-sm font-semibold\">\n00206|                         {diagnosis.condition.split('(')[0].trim()}\n00207|                       </CardTitle>\n00208|                       <div className=\"flex justify-between items-center\">\n00209|                         <Badge variant={diagnosis.met ? 'default' : 'secondary'} className=\"text-xs\">\n00210|                           {diagnosis.icdCode}\n00211|                         </Badge>\n00212|                         <Badge variant={diagnosis.met ? 'default' : 'outline'} className=\"text-xs\">\n00213|                           {diagnosis.met ? 'Met' : 'Not Met'}\n00214|                         </Badge>\n00215|                       </div>\n00216|                     </CardHeader>\n00217|                     <CardContent>\n00218|                       <div className=\"space-y-2\">\n00219|                         {diagnosis.criteria.map((criterion) => (\n00220|                           <div key={criterion.id} className=\"flex items-start gap-2 text-xs\">\n00221|                             <span className={criterion.met ? 'text-green-600' : 'text-gray-400'}>\n00222|                               {criterion.met ? '✓' : '✗'}\n00223|                             </span>\n00224|                             <span className={criterion.met ? 'text-green-700' : 'text-gray-600'}>\n00225|                               {criterion.description}\n00226|                             </span>\n00227|                           </div>\n00228|                         ))}\n00229|                       </div>\n00230|                     </CardContent>\n00231|                   </Card>\n00232|                 ))}\n00233|               </div>\n00234| \n00235|               <div className=\"bg-blue-50 p-4 rounded-lg\">\n00236|                 <h4 className=\"font-semibold mb-2 text-blue-900\">{t.criteria.results.clinicalRecommendations}</h4>\n00237|                 <div className=\"text-blue-800 text-sm space-y-2\">\n00238|                   {positives.some(d => d.id === 'mecfs') && (\n00239|                     <div>\n00240|                       <strong>ME/CFS Management:</strong>\n00241|                       <ul className=\"ml-4 list-disc space-y-1 mt-1\">\n00242|                         {t.criteria.results.mecfsManagement.map((item, index) => (\n00243|                           <li key={index}>{item}</li>\n00244|                         ))}\n00245|                       </ul>\n00246|                     </div>\n00247|                   )}\n00248|                   {positives.some(d => d.id === 'longcovid') && (\n00249|                     <div>\n00250|                       <strong>Long COVID Management:</strong>\n00251|                       <ul className=\"ml-4 list-disc space-y-1 mt-1\">\n00252|                         {t.criteria.results.longCovidManagement.map((item, index) => (\n00253|                           <li key={index}>{item}</li>\n00254|                         ))}\n00255|                       </ul>\n00256|                     </div>\n00257|                   )}\n00258|                   {positives.some(d => d.id === 'pots') && (\n00259|                     <div>\n00260|                       <strong>POTS Management:</strong>\n00261|                       <ul className=\"ml-4 list-disc space-y-1 mt-1\">\n00262|                         {t.criteria.results.potsManagement.map((item, index) => (\n00263|                           <li key={index}>{item}</li>\n00264|                         ))}\n00265|                       </ul>\n00266|                     </div>\n00267|                   )}\n00268|                 </div>\n00269|               </div>\n00270| \n00271|               <div className=\"flex gap-4 justify-center\">\n00272|                 <Button onClick={() => {\n00273|                   setMecfsChecked(getMECFSCriteria())\n00274|                   setLongCovidChecked(getLongCovidCriteria())\n00275|                   setPotsChecked(getPOTSCriteria())\n00276|                   setIsComplete(false)\n00277|                 }} variant=\"outline\">\n00278|                   {t.criteria.results.reassess}\n00279|                 </Button>\n00280|                 <Button onClick={() => {\n00281|                   const report = generateReport()\n00282|                   const blob = new Blob([report], { type: 'text/plain' })\n00283|                   const url = URL.createObjectURL(blob)\n00284|                   const a = document.createElement('a')\n00285|                   a.href = url\n00286|                   a.download = 'autodx-diagnostic-report.txt'\n00287|                   a.click()\n00288|                   URL.revokeObjectURL(url)\n00289|                 }} className=\"flex items-center gap-2\">\n00290|                   <Download className=\"h-4 w-4\" />\n00291|                   {t.criteria.results.downloadReport}\n00292|                 </Button>\n00293|                 {positives.some(d => d.id === 'pots') && (\n00294|                   <Button asChild>\n00295|                     <Link href=\"/subtype-advisor\">\n00296|                       {t.criteria.results.potsSubtype}\n00297|                     </Link>\n00298|                   </Button>\n00299|                 )}\n00300|               </div>\n00301|             </CardContent>\n00302|           </Card>\n00303|         </div>\n00304|       </div>\n00305|     )\n00306|   }\n00307| \n00308|   return (\n00309|     <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8\">\n00310|       <div className=\"container mx-auto px-4 max-w-4xl\">\n00311|         <div className=\"mb-6\">\n00312|           <Link href=\"/\" className=\"inline-flex items-center gap-2 text-blue-600 hover:text-blue-800 mb-4\">\n00313|             <ArrowLeft className=\"h-4 w-4\" />\n00314|             {t.app.backToDashboard}\n00315|           </Link>\n00316|           \n00317|           <div className=\"flex items-center gap-4 mb-4\">\n00318|             <BarChart3 className=\"h-5 w-5 text-blue-600\" />\n00319|             <div>\n00320|               <h1 className=\"text-2xl font-bold text-gray-900\">{t.criteria.title}</h1>\n00321|               <p className=\"text-gray-600\">{t.criteria.description}</p>\n00322|             </div>\n00323|           </div>\n00324|         </div>\n00325| \n00326|         <div className=\"space-y-6\">\n00327|           <Card>\n00328|             <CardHeader>\n00329|               <CardTitle className=\"text-lg text-blue-800\">{t.criteria.mecfs.title}</CardTitle>\n00330|               <CardDescription>\n00331|                 {t.criteria.mecfs.description}\n00332|               </CardDescription>\n00333|             </CardHeader>\n00334|             <CardContent>\n00335|               <div className=\"space-y-3\">\n00336|                 {mecfsChecked.map((criterion) => (\n00337|                   <div key={criterion.id} className=\"flex items-start space-x-3 p-3 rounded-lg border hover:bg-gray-50\">\n00338|                     <Checkbox\n00339|                       id={criterion.id}\n00340|                       checked={criterion.met}\n00341|                       onCheckedChange={(checked) => handleMECFSChange(criterion.id, !!checked)}\n00342|                     />\n00343|                     <Label htmlFor={criterion.id} className=\"cursor-pointer text-sm flex-1\">\n00344|                       {criterion.description}\n00345|                     </Label>\n00346|                   </div>\n00347|                 ))}\n00348|               </div>\n00349|             </CardContent>\n00350|           </Card>\n00351| \n00352|           <Card>\n00353|             <CardHeader>\n00354|               <CardTitle className=\"text-lg text-green-800\">{t.criteria.longCovid.title}</CardTitle>\n00355|               <CardDescription>\n00356|                 {t.criteria.longCovid.description}\n00357|               </CardDescription>\n00358|             </CardHeader>\n00359|             <CardContent>\n00360|               <div className=\"space-y-3\">\n00361|                 {longCovidChecked.map((criterion) => (\n00362|                   <div key={criterion.id} className=\"flex items-start space-x-3 p-3 rounded-lg border hover:bg-gray-50\">\n00363|                     <Checkbox\n00364|                       id={criterion.id}\n00365|                       checked={criterion.met}\n00366|                       onCheckedChange={(checked) => handleLongCovidChange(criterion.id, !!checked)}\n00367|                     />\n00368|                     <Label htmlFor={criterion.id} className=\"cursor-pointer text-sm flex-1\">\n00369|                       {criterion.description}\n00370|                     </Label>\n00371|                   </div>\n00372|                 ))}\n00373|               </div>\n00374|               \n00375|               {longCovidChecked.find(c => c.id === 'covid_history')?.met && (\n00376|                 <div className=\"mt-4 p-3 bg-green-50 rounded-lg\">\n00377|                   <Label className=\"text-sm font-medium\">COVID-19 infection timing:</Label>\n00378|                   <RadioGroup value={covidTiming} onValueChange={setCovidTiming} className=\"mt-2\">\n00379|                     <div className=\"flex items-center space-x-2\">\n00380|                       <RadioGroupItem value=\"confirmed\" id=\"confirmed\" />\n00381|                       <Label htmlFor=\"confirmed\" className=\"text-sm\">{t.criteria.longCovid.timing.confirmed}</Label>\n00382|                     </div>\n00383|                     <div className=\"flex items-center space-x-2\">\n00384|                       <RadioGroupItem value=\"probable\" id=\"probable\" />\n00385|                       <Label htmlFor=\"probable\" className=\"text-sm\">{t.criteria.longCovid.timing.probable}</Label>\n00386|                     </div>\n00387|                     <div className=\"flex items-center space-x-2\">\n00388|                       <RadioGroupItem value=\"suspected\" id=\"suspected\" />\n00389|                       <Label htmlFor=\"suspected\" className=\"text-sm\">{t.criteria.longCovid.timing.suspected}</Label>\n00390|                     </div>\n00391|                   </RadioGroup>\n00392|                 </div>\n00393|               )}\n00394|             </CardContent>\n00395|           </Card>\n00396| \n00397|           <Card>\n00398|             <CardHeader>\n00399|               <CardTitle className=\"text-lg text-purple-800\">{t.criteria.pots.title}</CardTitle>\n00400|               <CardDescription>\n00401|                 {t.criteria.pots.description}\n00402|               </CardDescription>\n00403|             </CardHeader>\n00404|             <CardContent>\n00405|               <div className=\"space-y-3\">\n00406|                 {potsChecked.map((criterion) => (\n00407|                   <div key={criterion.id} className=\"flex items-start space-x-3 p-3 rounded-lg border hover:bg-gray-50\">\n00408|                     <Checkbox\n00409|                       id={criterion.id}\n00410|                       checked={criterion.met}\n00411|                       onCheckedChange={(checked) => handlePOTSChange(criterion.id, !!checked)}\n00412|                     />\n00413|                     <Label htmlFor={criterion.id} className=\"cursor-pointer text-sm flex-1\">\n00414|                       {criterion.description}\n00415|                     </Label>\n00416|                   </div>\n00417|                 ))}\n00418|               </div>\n00419|             </CardContent>\n00420|           </Card>\n00421| \n00422|           <div className=\"flex justify-center\">\n00423|             <Button onClick={() => setIsComplete(true)} size=\"lg\" className=\"px-8\">\n00424|               <FileText className=\"h-4 w-4 mr-2\" />\n00425|               Generate Diagnostic Report\n00426|             </Button>\n00427|           </div>\n00428|         </div>\n00429|       </div>\n00430|     </div>\n00431|   )\n00432| }\n</file>",
    "metadata": {
      "preview": "'use client'\n\nimport { useState } from 'react'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Checkbox } from '@/components/ui/checkbox'\nimport { Badge } from '@/components/ui/badge'\nimport { Alert, AlertDescription } from '@/components/ui/alert'\nimport { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group'\nimport { Label } from '@/components/ui/label'\nimport { ArrowLeft, BarChart3, CheckCircle, AlertTriangle, FileText, Download } from 'lucide-react'\nimport Link from 'next/link'\nimport { useTranslation } from '@/lib/language-context'\n\ninterface DiagnosticCriteria {\n  id: string\n  condition: string\n  met: boolean\n  criteria: { id: string; description: string; met: boolean }[]\n  icdCode: string"
    },
    "title": "app/criteria-engine/page.tsx",
    "time": {
      "start": 1758132638655,
      "end": 1758132638659
    }
  }
}